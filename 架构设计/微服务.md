### 微服务的基本组件
    a 服务描述
    b 注册中心
    c 服务框架
    d 服务监控
    e 服务追踪
    f 服务治理
### 服务发布和引用
    最常见的三种
    a> restful api  [motan]
    b> xml 配置
    c> idl文件  
### 服务注册和发现
    注册中心
    rpc server 注册到注册中心 
    rpc client 订阅服务
    注册中心API：
      通知服务的变更给rpc client ，rpc client做出相应的调整 
      服务注册接口
      服务注销接口
      心跳汇报接口
      服务订阅接口：订阅相关服务，来获取可用的服务列表
      服务变更查询接口：
      其他管理的接口
      服务查询接口：查询注册中心注册哪些注册服务
      服务修改接口：修改一些接口信息
    集群部署：zookeeper 实现高可用
    目录存储：zk 目录，用于分类服务
    服务健康监测：服务和zookeeper服务端之间的长连接和会话超时机制来实现服务的监控监测，在session_time_out 内，zkclient 也就是服务会发送心跳
    到zk server端，zk server重置session timeout ，如果超过session timeout 还没有收到client 发送的心跳，就是客户端也就是服务down掉了，会从注册中心删除
    对应的节点。
    服务状态的变更通知：zk watcher机制，来刷新本地缓存。
    白名单机制：只有白名单内的client 才可以访问注册中心
    
    问题：注册中心 和dns 有什么区别？

### 如何实现rpc 远程过程调用
    remote process call
    客户端和服务端如何建立连接？ http，tpc ，还是其他？
    服务端如何处理请求？ aio bio nio
    数据传输采用什么协议？http协议：定义头之类的信息。还是自定义协议，还是thrift协议，dubbo协议
    数据该如何序列化和反序列化？java自带、json、xml、thrit、pb
    
    简单说下自己基于tcp连接实现的过程：
    服务启动服务之后，会实例化相应的服务和socket 端口等待连接接，客户端引用这个接口，通过socket接口，要调用的接口、
    方法、方法参数和类型序列化后发送给服务端的socket，服务端接受到连接之后，读取完流，进行反序列化，得到要调用的接口、
    方法、方法参数、和方法参数类型，然后找到相对应实现类，并调用用相应的方法执行，然后拿到返回值，在进行序列化，发送给
    客户端，接着客户端读取服务端响应，进行返回值的反序列化操作，至此一次rpc调用结束。为了达到更高的吞吐量，可socket可以用
    nio，来实现或者池化技术来实现。
    
### 如何监控服务调用
    监控对象：
       用户端监控：用户端功能的监控
       接口监控： 具体接口的监控
       资源监控：某个接口依赖资源的监控，用户服务依赖redis，对redis资源的监控，就是资源的监控
       基础监控：服务器本身健康状况的监控：cpu、内存使用、io读写、网卡带宽等
    监控指标：
        请求量： 总请求量（PV），qps、分时间段请求量
        响应时间：0-10ms ，10-30ms 这种来统计请求量、还有平均响应时间，还有p90 p95 p99 p999 p99=500ms 就带表99%请求里是500ms以内，代表了请求的服务质量
        错误率：在一段时间调用接口失败的次数占总调用数的比率，可以按照code 来划分
    监控维度    
      全局维度：
      分机房维度：
      单机维度：
      时间维度：每天对比，周对比、月对比等，指标都会有差异
      核心维度： 对主要的核心业务进行重点监控
    
    监控系统原理：
       数据采集：采样率怎么设置，还是动态设置，主动上报、还是代理上报（agent)
       数据传输: udp、kafka，传输格式：二进制，json等。
       数据处理：
       数据展示：dashbord
    系统监控开源;zipkin，pinpoint， skywalking
    展示开源：granfanna
    
### 如何追踪服务调用
    链路追踪 都是基于Dapper 论文开发的
    开源：zipkin 阿里的鹰眼、美团mtrace
            
### 微服务治理的手段有哪些 
    节点管理：
        1、注册中心主动摘取机制，server 和 注册中心之间存在心跳，超时内多次未响应，注册中心摘除server服务并推送给订阅改服务的client
        2、服务消费者摘除机制：client 和server 之间也会有心跳，超时内多次未响应，client 会在本地内存中摘除server服务
    负载均衡【随机、轮询、轮询权重、最少请求数、最少链接数、一致性hash、取模】
    路由
       1存在路由的原因：
        a 业务存在灰度发布的过程或者流量分配
        b 多机房(IDC)就近访问的需求
       2 路由配置
         a 静态配置：在消费者client 端直接配置路由
         b 动态配置：路由规则存在注册中心或者配置中心，改变后推送给响应的订阅者client
    服务容错  
      FailOver： 失败自动切换，失败后自动切换到另一个服务实例重试。这种操作必须是幂等的。
      FailBack：失败通知，失败之后不立即重试，而是根据服务返回的信息来决定后续的调用策略，如幂等操作。
      FailCache: 失败缓存，就是失败后，不会立即重试，而是隔一段时间后在发起重新调用，立即重试可能超过服务的承受范围，而更糟糕      

### 注册中心
    1、注册中心如何存储服务信息
       服务分组、服务名称、IP、PORT、路由信息、重试次数，超时等。
    2、注册
    3、注销服务
    4、查询服务信息           
    5、订阅服务变更
    
    开源注册中心：
    eureka、consul、zookeeper、etcd
    